machine:
  xcode:
    version: 8.2

test:
  override:
    - set -o pipefail
    - xcodebuild CODE_SIGNING_REQUIRED=NO CODE_SIGN_IDENTITY="" PROVISIONING_PROFILE="" -configuration Debug -sdk iphonesimulator -destination 'name=iPhone 6,OS=10.2' -scheme "Main" test | tee $CIRCLE_ARTIFACTS/xcode_raw.log | xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results.xml

deployment:
  alpha_distribution:
    branch: develop
    commands:
      - sed -i '' 's/ProvisioningStyle = Automatic/ProvisioningStyle = Manual/g' Example\ Project.xcodeproj/project.pbxproj
      - fastlane gym -s "Main" -q "Alpha" -j ad-hoc -o $CIRCLE_ARTIFACTS --xcargs "BUNDLE_VERSION=$CIRCLE_BUILD_NUM"

  beta_distribution:
    branch: release
    commands:
      - sed -i '' 's/ProvisioningStyle = Automatic/ProvisioningStyle = Manual/g' Example\ Project.xcodeproj/project.pbxproj
      - sed -i '' 's/DevelopmentTeam = 957K4ZUMJV/DevelopmentTeam = BGC57N7M47/g' Example\ Project.xcodeproj/project.pbxproj
      - sed -i '' 's/DEVELOPMENT_TEAM = 957K4ZUMJV/DEVELOPMENT_TEAM = BGC57N7M47/g' Example\ Project.xcodeproj/project.pbxproj
      - fastlane gym -s "Main" -q "Release" -j enterprise -o $CIRCLE_ARTIFACTS --xcargs "BUNDLE_VERSION=$CIRCLE_BUILD_NUM"
      - ipa distribute:hockeyapp
          --file             $CIRCLE_ARTIFACTS/Example\ Project.ipa
          --token            "388a6e9b9e66497c8c8c002e00e800ae"
          --notes            "Pull Request Notes go here"
          --commit-sha       "$CIRCLE_SHA1"
          --build-server-url "$CIRCLE_BUILD_URL"
          --repository-url   "$CIRCLE_REPOSITORY_URL"

