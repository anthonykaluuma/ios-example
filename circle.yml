machine:
  xcode:
    version: 8.2

dependencies:
  pre:
    - xcrun instruments -w 'iPhone 5 (9.3)' || true

test:
  override:
    - xcrun simctl list
    - set -o pipefail
    - xcodebuild CODE_SIGNING_REQUIRED=NO CODE_SIGN_IDENTITY="" PROVISIONING_PROFILE="" -configuration Debug -sdk iphonesimulator -destination 'name=iPhone 5,OS=9.3' -scheme "Main" clean build test | tee $CIRCLE_ARTIFACTS/xcode_raw.log | xcpretty --color --report junit --output $CIRCLE_TEST_REPORTS/xcode/results.xml

deployment:
  alpha_distribution:
    branch: develop
    commands:
      - fastlane gym -s "Main" -q "Alpha" -j ad-hoc -o $CIRCLE_ARTIFACTS
  beta_distribution:
    branch: release
    commands:
      - fastlane gym -s "Main" -q "Beta" -j enterprise -o $CIRCLE_ARTIFACTS

